; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\Z2170P\SRC\APP\SIMPLE\DLL\simpledll.c
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "


  00000			 AREA	 |.bss|, NOINIT
|?pVirtualMemoryAddress@?1??SID_IOControl@@9@9| % 0x4	; `SID_IOControl'::`2'::pVirtualMemoryAddress
	EXPORT	|GetCurrentProcess|
; File c:\wince600\public\common\sdk\inc\kfuncs.h

  00000			 AREA	 |.pdata|, PDATA
|$T40272| DCD	|$LN5@GetCurrent|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |GetCurrentProcess| PROC

; 361  : _inline HANDLE GetCurrentProcess(void) {

  00000		 |$LN5@GetCurrent|
  00000		 |$M40269|

; 362  : 	return ((HANDLE)(SH_CURPROC+SYS_HANDLE_BASE));

  00000	e3a00042	 mov         r0, #0x42

; 363  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40270|

			 ENDP  ; |GetCurrentProcess|

	EXPORT	|DllMain|
	IMPORT	|DisableThreadLibraryCalls|
; File c:\wince600\platform\z2170p\src\app\simple\dll\simpledll.c

  00000			 AREA	 |.pdata|, PDATA
|$T40283| DCD	|$LN11@DllMain|
	DCD	0x40000601
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |DllMain| PROC

; 50   : {

  00000		 |$LN11@DllMain|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004		 |$M40280|

; 51   :     switch (fdwReason)

  00004	e3510001	 cmp         r1, #1

; 52   :     {
; 53   :         case DLL_PROCESS_ATTACH:
; 54   :             DisableThreadLibraryCalls((HMODULE) hinstDll);

  00008	0b000000	 bleq        DisableThreadLibraryCalls

; 55   :             break;
; 56   : 
; 57   :         case DLL_THREAD_ATTACH:
; 58   :             break;
; 59   : 
; 60   :         case DLL_THREAD_DETACH:
; 61   :             break;
; 62   : 
; 63   :         case DLL_PROCESS_DETACH:
; 64   :             break;
; 65   :     }
; 66   :     return TRUE;

  0000c	e3a00001	 mov         r0, #1

; 67   : }

  00010	e49de004	 ldr         lr, [sp], #4
  00014	e12fff1e	 bx          lr
  00018		 |$M40281|

			 ENDP  ; |DllMain|

	EXPORT	|SID_Init|

  00000			 AREA	 |.pdata|, PDATA
|$T40292| DCD	|$LN5@SID_Init|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_Init| PROC

; 76   : {

  00000		 |$LN5@SID_Init|
  00000		 |$M40289|

; 77   :     return 1;

  00000	e3a00001	 mov         r0, #1

; 78   : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40290|

			 ENDP  ; |SID_Init|

	EXPORT	|SID_Open|

  00000			 AREA	 |.pdata|, PDATA
|$T40301| DCD	|$LN5@SID_Open|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_Open| PROC

; 81   : {

  00000		 |$LN5@SID_Open|
  00000		 |$M40298|

; 82   :     return 1;

  00000	e3a00001	 mov         r0, #1

; 83   : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40299|

			 ENDP  ; |SID_Open|

	EXPORT	|SID_Close|

  00000			 AREA	 |.pdata|, PDATA
|$T40310| DCD	|$LN5@SID_Close|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_Close| PROC

; 86   : {

  00000		 |$LN5@SID_Close|
  00000		 |$M40307|

; 87   :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 88   : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40308|

			 ENDP  ; |SID_Close|

	EXPORT	|SID_Deinit|

  00000			 AREA	 |.pdata|, PDATA
|$T40319| DCD	|$LN5@SID_Deinit|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_Deinit| PROC

; 91   : {

  00000		 |$LN5@SID_Deinit|
  00000		 |$M40316|

; 92   :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 93   : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40317|

			 ENDP  ; |SID_Deinit|

	EXPORT	|SID_IOControl|
	IMPORT	|VirtualAllocCopyEx|
	IMPORT	|GetOwnerProcess|
	IMPORT	|AllocPhysMem|
	IMPORT	|FreePhysMem|
; File c:\wince600\public\common\sdk\inc\kfuncs.h

  00000			 AREA	 |.pdata|, PDATA
|$T40337| DCD	|$LN15@SID_IOCont|
	DCD	0x40002b02
; Function compile flags: /Ogspy
; File c:\wince600\platform\z2170p\src\app\simple\dll\simpledll.c

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_IOControl| PROC

; 96   : {

  00000		 |$LN15@SID_IOCont|
  00000	e92d4030	 stmdb       sp!, {r4, r5, lr}
  00004	e24dd008	 sub         sp, sp, #8
  00008		 |$M40334|
  00008	e3510000	 cmp         r1, #0

; 97   :     static LPVOID pVirtualMemoryAddress = NULL;
; 98   :     LPVOID pVirtualMemoryAddressCaller = NULL;
; 99   :     DWORD PhysicalAddress = 0;

  0000c	e3a03000	 mov         r3, #0
  00010	e58d3004	 str         r3, [sp, #4]

; 100  : 
; 101  :     switch (dwCode)

  00014	0a000005	 beq         |$LN4@SID_IOCont|
  00018	e3510001	 cmp         r1, #1

; 116  :             break;
; 117  :         }
; 118  :         
; 119  :         case SIMPLEDLL_IOCTL_FREE_PHYSICAL_MEMORY:
; 120  :             FreePhysMem(pVirtualMemoryAddress);
; 121  :             return TRUE;
; 122  :             break;
; 123  :     }
; 124  :     
; 125  :     return FALSE;

  0001c	1a00000f	 bne         |$LN12@SID_IOCont|
  00020	e59f3080	 ldr         r3, [pc, #0x80]
  00024	e5930000	 ldr         r0, [r3]
  00028	eb000000	 bl          FreePhysMem
  0002c	ea000019	 b           |$LN11@SID_IOCont|
  00030		 |$LN4@SID_IOCont|

; 102  :     {
; 103  :         case SIMPLEDLL_IOCTL_ALLOCATE_PHYSICAL_MEMORY:
; 104  :         {
; 105  :             DWORD RequestedSize = *(DWORD *)pBufIn;

  00030	e5924000	 ldr         r4, [r2]

; 106  :             pVirtualMemoryAddress = AllocPhysMem(RequestedSize, PAGE_READWRITE|PAGE_NOCACHE, 0, 0, &PhysicalAddress);

  00034	e28de004	 add         lr, sp, #4
  00038	e3a03000	 mov         r3, #0
  0003c	e1a00004	 mov         r0, r4
  00040	e3a02000	 mov         r2, #0
  00044	e3a01f81	 mov         r1, #0x81, 30
  00048	e58de000	 str         lr, [sp]
  0004c	eb000000	 bl          AllocPhysMem
  00050	e59f5050	 ldr         r5, [pc, #0x50]
  00054	e3500000	 cmp         r0, #0
  00058	e5850000	 str         r0, [r5]

; 107  :             if (pVirtualMemoryAddress == NULL)

  0005c	1a000001	 bne         |$LN3@SID_IOCont|
  00060		 |$LN12@SID_IOCont|

; 108  :                 return FALSE;

  00060	e3a00000	 mov         r0, #0
  00064	ea00000c	 b           |$LN7@SID_IOCont|
  00068		 |$LN3@SID_IOCont|

; 109  :                 
; 110  :             pVirtualMemoryAddressCaller = VirtualAllocCopyEx(GetCurrentProcess(), GetOwnerProcess(), (LPVOID)pVirtualMemoryAddress, RequestedSize, PAGE_READWRITE|PAGE_NOCACHE);    

  00068	eb000000	 bl          GetOwnerProcess
  0006c	e5952000	 ldr         r2, [r5]
  00070	e1a01000	 mov         r1, r0
  00074	e3a0ef81	 mov         lr, #0x81, 30
  00078	e3a00042	 mov         r0, #0x42
  0007c	e1a03004	 mov         r3, r4
  00080	e58de000	 str         lr, [sp]
  00084	eb000000	 bl          VirtualAllocCopyEx
  00088	e1b02000	 movs        r2, r0

; 111  :             if (pVirtualMemoryAddressCaller == NULL)
; 112  :                 return FALSE;

  0008c	0afffff3	 beq         |$LN12@SID_IOCont|

; 113  : 
; 114  :             *(DWORD *)pBufOut = (DWORD)pVirtualMemoryAddressCaller;

  00090	e59d3014	 ldr         r3, [sp, #0x14]

; 115  :             return TRUE;

  00094	e5832000	 str         r2, [r3]
  00098		 |$LN11@SID_IOCont|
  00098	e3a00001	 mov         r0, #1
  0009c		 |$LN7@SID_IOCont|

; 126  : }

  0009c	e28dd008	 add         sp, sp, #8
  000a0	e8bd4030	 ldmia       sp!, {r4, r5, lr}
  000a4	e12fff1e	 bx          lr
  000a8		 |$LN16@SID_IOCont|
  000a8		 |$LN17@SID_IOCont|
  000a8	00000000	 DCD         |?pVirtualMemoryAddress@?1??SID_IOControl@@9@9|
  000ac		 |$M40335|

			 ENDP  ; |SID_IOControl|

	EXPORT	|SID_PowerDown|

  00000			 AREA	 |.pdata|, PDATA
|$T40346| DCD	|$LN5@SID_PowerD|
	DCD	0x40000100
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_PowerDown| PROC

; 129  : {

  00000		 |$LN5@SID_PowerD|
  00000		 |$M40343|

; 130  : }

  00000	e12fff1e	 bx          lr
  00004		 |$M40344|

			 ENDP  ; |SID_PowerDown|

	EXPORT	|SID_PowerUp|

  00000			 AREA	 |.pdata|, PDATA
|$T40353| DCD	|$LN5@SID_PowerU|
	DCD	0x40000100
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_PowerUp| PROC

; 133  : {

  00000		 |$LN5@SID_PowerU|
  00000		 |$M40350|

; 134  : }

  00000	e12fff1e	 bx          lr
  00004		 |$M40351|

			 ENDP  ; |SID_PowerUp|

	EXPORT	|SID_Read|

  00000			 AREA	 |.pdata|, PDATA
|$T40362| DCD	|$LN5@SID_Read|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_Read| PROC

; 137  : {

  00000		 |$LN5@SID_Read|
  00000		 |$M40359|

; 138  :     return 0;

  00000	e3a00000	 mov         r0, #0

; 139  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40360|

			 ENDP  ; |SID_Read|

	EXPORT	|SID_Write|

  00000			 AREA	 |.pdata|, PDATA
|$T40371| DCD	|$LN5@SID_Write|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_Write| PROC

; 142  : {

  00000		 |$LN5@SID_Write|
  00000		 |$M40368|

; 143  :     return -1;

  00000	e3e00000	 mvn         r0, #0

; 144  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40369|

			 ENDP  ; |SID_Write|

	EXPORT	|SID_Seek|

  00000			 AREA	 |.pdata|, PDATA
|$T40380| DCD	|$LN5@SID_Seek|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SID_Seek| PROC

; 147  : {

  00000		 |$LN5@SID_Seek|
  00000		 |$M40377|

; 148  :     return -1;

  00000	e3e00000	 mvn         r0, #0

; 149  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M40378|

			 ENDP  ; |SID_Seek|

	END
