; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\Z2170P\SRC\DRIVERS\sysctrl\sysctrl.cpp
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "

	EXPORT	|?ghInstance@@3PAUHINSTANCE__@@A| [ DATA ] ; ghInstance

  00000			 AREA	 |.bss|, NOINIT
|?ghInstance@@3PAUHINSTANCE__@@A| % 0x4			; ghInstance
	EXPORT	|DllMain|
; File c:\wince600\platform\z2170p\src\drivers\sysctrl\sysctrl.cpp

  00000			 AREA	 |.pdata|, PDATA
|$T32132| DCD	|$LN11@DllMain|
	DCD	0x40000600
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |DllMain| PROC

; 49   : {

  00000		 |$LN11@DllMain|
  00000		 |$M32129|

; 50   : 	UNREFERENCED_PARAMETER(lpvReserved);
; 51   : 	
; 52   :     switch(dwReason)

  00000	e3510001	 cmp         r1, #1

; 53   :     {
; 54   :         case DLL_PROCESS_ATTACH:
; 55   :             ghInstance = (HINSTANCE) hinstDll;

  00004	059f3008	 ldreq       r3, [pc, #8]
  00008	05830000	 streq       r0, [r3]

; 56   :             break;
; 57   : 
; 58   :         case DLL_PROCESS_DETACH:
; 59   :             //RETAILMSG(1, (TEXT("IoDispatch_DllEntry: DLL_PROCESS_DETACH\r\n")));
; 60   :             break;
; 61   : 
; 62   :         case DLL_THREAD_ATTACH:
; 63   :             //RETAILMSG(1, (TEXT("IoDispatch_DllEntry: DLL_THREAD_ATTACH\r\n")));
; 64   :             break;
; 65   : 
; 66   :         case DLL_THREAD_DETACH:
; 67   :             //RETAILMSG(1, (TEXT("IoDispatch_DllEntry: DLL_THREAD_DETACH\r\n")));
; 68   :             break;
; 69   :     }
; 70   : 
; 71   :     // return TRUE for success, FALSE for failure
; 72   :     return TRUE;

  0000c	e3a00001	 mov         r0, #1

; 73   : }

  00010	e12fff1e	 bx          lr
  00014		 |$LN12@DllMain|
  00014		 |$LN13@DllMain|
  00014	00000000	 DCD         |?ghInstance@@3PAUHINSTANCE__@@A|
  00018		 |$M32130|

			 ENDP  ; |DllMain|

	EXPORT	|?SYS_Init@@YAKK@Z|			; SYS_Init
	IMPORT	|CloseHandle|
	IMPORT	|CreateThread|
	IMPORT	|?StartupThread@@YAKPAX@Z|		; StartupThread

  00000			 AREA	 |.pdata|, PDATA
|$T32144| DCD	|$LN5@SYS_Init|
	DCD	0x40001002
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_Init@@YAKK@Z| PROC		; SYS_Init

; 76   : {

  00000		 |$LN5@SYS_Init|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004	e24dd008	 sub         sp, sp, #8
  00008		 |$M32141|

; 77   : 	UNREFERENCED_PARAMETER(dwData);
; 78   : 	//Init_LED();
; 79   : 
; 80   :     HANDLE hStartup = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE) StartupThread, NULL, 0, NULL);

  00008	e59f202c	 ldr         r2, [pc, #0x2C]
  0000c	e3a0e000	 mov         lr, #0
  00010	e3a03000	 mov         r3, #0
  00014	e3a01000	 mov         r1, #0
  00018	e3a00000	 mov         r0, #0
  0001c	e58de004	 str         lr, [sp, #4]
  00020	e58de000	 str         lr, [sp]
  00024	eb000000	 bl          CreateThread

; 81   :     CloseHandle(hStartup);

  00028	eb000000	 bl          CloseHandle

; 82   : 
; 83   :     //HANDLE hPower = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE) SYSTEM_POWER_Thread, NULL, 0, NULL);
; 84   :     //CloseHandle(hPower);
; 85   : 
; 86   :     //HANDLE hTrayIcon = CreateThread(NULL, 0, TrayIconThread, NULL, 0, NULL);
; 87   :     //CloseHandle(hTrayIcon);
; 88   : 
; 89   :     //HANDLE hLED = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE) LEDThread, NULL, 0, NULL);
; 90   :     //CloseHandle(hLED);
; 91   : 
; 92   :     //HANDLE hBTThread = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE) BluetoothNotifyThread, NULL, 0, NULL);
; 93   :     //CloseHandle(hBTThread);
; 94   : 
; 95   :     //HANDLE hWiFiThread = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)NpwStartNotification, NULL, 0, NULL);
; 96   :     //CloseHandle(hWiFiThread);
; 97   : 
; 98   :     return 1;

  0002c	e3a00001	 mov         r0, #1

; 99   : }

  00030	e28dd008	 add         sp, sp, #8
  00034	e49de004	 ldr         lr, [sp], #4
  00038	e12fff1e	 bx          lr
  0003c		 |$LN6@SYS_Init|
  0003c		 |$LN7@SYS_Init|
  0003c	00000000	 DCD         |?StartupThread@@YAKPAX@Z|
  00040		 |$M32142|

			 ENDP  ; |?SYS_Init@@YAKK@Z|, SYS_Init

	EXPORT	|?SYS_Deinit@@YAHK@Z|			; SYS_Deinit

  00000			 AREA	 |.pdata|, PDATA
|$T32155| DCD	|$LN5@SYS_Deinit|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_Deinit@@YAHK@Z| PROC		; SYS_Deinit

; 103  : {

  00000		 |$LN5@SYS_Deinit|
  00000		 |$M32152|

; 104  : 	UNREFERENCED_PARAMETER(dwData);
; 105  :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 106  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32153|

			 ENDP  ; |?SYS_Deinit@@YAHK@Z|, SYS_Deinit

	EXPORT	|?SYS_Open@@YAHKKK@Z|			; SYS_Open

  00000			 AREA	 |.pdata|, PDATA
|$T32164| DCD	|$LN5@SYS_Open|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_Open@@YAHKKK@Z| PROC		; SYS_Open

; 115  : {

  00000		 |$LN5@SYS_Open|
  00000		 |$M32161|

; 116  : 	UNREFERENCED_PARAMETER(dwData);
; 117  : 	UNREFERENCED_PARAMETER(dwAccess);
; 118  : 	UNREFERENCED_PARAMETER(dwShareMode);
; 119  :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 120  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32162|

			 ENDP  ; |?SYS_Open@@YAHKKK@Z|, SYS_Open

	EXPORT	|?SYS_Close@@YAHK@Z|			; SYS_Close

  00000			 AREA	 |.pdata|, PDATA
|$T32173| DCD	|$LN5@SYS_Close|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_Close@@YAHK@Z| PROC		; SYS_Close

; 125  : {

  00000		 |$LN5@SYS_Close|
  00000		 |$M32170|

; 126  : 	UNREFERENCED_PARAMETER(dwData);
; 127  :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 128  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32171|

			 ENDP  ; |?SYS_Close@@YAHK@Z|, SYS_Close

	EXPORT	|?SYS_Read@@YAKKPAIK@Z|			; SYS_Read

  00000			 AREA	 |.pdata|, PDATA
|$T32182| DCD	|$LN5@SYS_Read|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_Read@@YAKKPAIK@Z| PROC		; SYS_Read

; 137  : {

  00000		 |$LN5@SYS_Read|
  00000		 |$M32179|

; 138  : 	UNREFERENCED_PARAMETER(dwData);
; 139  : 	UNREFERENCED_PARAMETER(pBuffer);
; 140  : 	UNREFERENCED_PARAMETER(dwLen);
; 141  :     return 0;

  00000	e3a00000	 mov         r0, #0

; 142  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32180|

			 ENDP  ; |?SYS_Read@@YAKKPAIK@Z|, SYS_Read

	EXPORT	|?SYS_Write@@YAKKPAIK@Z|		; SYS_Write

  00000			 AREA	 |.pdata|, PDATA
|$T32191| DCD	|$LN5@SYS_Write|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_Write@@YAKKPAIK@Z| PROC		; SYS_Write

; 150  : {

  00000		 |$LN5@SYS_Write|
  00000		 |$M32188|

; 151  : 	UNREFERENCED_PARAMETER(dwData);
; 152  : 	UNREFERENCED_PARAMETER(pBuffer);
; 153  : 	UNREFERENCED_PARAMETER(dwInLen);
; 154  :     return 0;

  00000	e3a00000	 mov         r0, #0

; 155  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32189|

			 ENDP  ; |?SYS_Write@@YAKKPAIK@Z|, SYS_Write

	EXPORT	|?SYS_Seek@@YAKKJK@Z|			; SYS_Seek

  00000			 AREA	 |.pdata|, PDATA
|$T32200| DCD	|$LN5@SYS_Seek|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_Seek@@YAKKJK@Z| PROC		; SYS_Seek

; 163  : {

  00000		 |$LN5@SYS_Seek|
  00000		 |$M32197|

; 164  : 	UNREFERENCED_PARAMETER(dwData);
; 165  : 	UNREFERENCED_PARAMETER(pos);
; 166  : 	UNREFERENCED_PARAMETER(type);
; 167  :     return 0;

  00000	e3a00000	 mov         r0, #0

; 168  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32198|

			 ENDP  ; |?SYS_Seek@@YAKKJK@Z|, SYS_Seek

	EXPORT	|?SYS_PowerUp@@YAHXZ|			; SYS_PowerUp

  00000			 AREA	 |.pdata|, PDATA
|$T32209| DCD	|$LN5@SYS_PowerU|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_PowerUp@@YAHXZ| PROC		; SYS_PowerUp

; 173  : {

  00000		 |$LN5@SYS_PowerU|
  00000		 |$M32206|

; 174  :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 175  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32207|

			 ENDP  ; |?SYS_PowerUp@@YAHXZ|, SYS_PowerUp

	EXPORT	|?SYS_PowerDown@@YAHXZ|			; SYS_PowerDown

  00000			 AREA	 |.pdata|, PDATA
|$T32218| DCD	|$LN5@SYS_PowerD|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_PowerDown@@YAHXZ| PROC		; SYS_PowerDown

; 179  : {

  00000		 |$LN5@SYS_PowerD|
  00000		 |$M32215|

; 180  :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 181  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32216|

			 ENDP  ; |?SYS_PowerDown@@YAHXZ|, SYS_PowerDown

	EXPORT	|?SYS_IOControl@@YAHKKPAXK0KPAK@Z|	; SYS_IOControl

  00000			 AREA	 |.pdata|, PDATA
|$T32227| DCD	|$LN5@SYS_IOCont|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?SYS_IOControl@@YAHKKPAXK0KPAK@Z| PROC ; SYS_IOControl

; 192  : {

  00000		 |$LN5@SYS_IOCont|
  00000		 |$M32224|

; 193  :     //BOOL dwState = FALSE;
; 194  : 	//uNandFLASH *lpFPro=NULL;
; 195  : 	//NandRead *lpNRead=NULL;
; 196  : 	UNREFERENCED_PARAMETER(dwInst);
; 197  : 	UNREFERENCED_PARAMETER(lpInBuf);
; 198  : 	UNREFERENCED_PARAMETER(nInBufSize);
; 199  : 	UNREFERENCED_PARAMETER(lpOutBuf);
; 200  : 	UNREFERENCED_PARAMETER(nOutBufSize);
; 201  : 	UNREFERENCED_PARAMETER(lpBytesReturned);
; 202  : 	UNREFERENCED_PARAMETER(dwIoControlCode);
; 203  : 		
; 204  :  //   switch(dwIoControlCode)
; 205  : //	{
; 206  : /*
; 207  :         case ZSYS_GetBootInformation:
; 208  : 
; 209  :             *(volatile WORD *)lpOutBuf = *(volatile WORD *)BOOT_MODE_STORE_ADDR;
; 210  : 
; 211  :             *lpBytesReturned = sizeof(WORD);
; 212  : 
; 213  :             break;
; 214  : 
; 215  : 
; 216  :         case ZSYS_GetSystemInformation:
; 217  : 
; 218  :             memcpy((BYTE *)lpOutBuf, (BYTE *)SYSTEM_INFORMATION_MEMORY_START, sizeof(SysInfor));
; 219  : 
; 220  :             *lpBytesReturned = sizeof(SysInfor);
; 221  :             break;
; 222  : 
; 223  : 
; 224  :         case ZSYS_SetSystemInformation:
; 225  : 
; 226  :             memcpy((BYTE *)SYSTEM_INFORMATION_MEMORY_START, (BYTE *)lpInBuf, sizeof(SysInfor));
; 227  : 
; 228  :             return TRUE;
; 229  : 
; 230  : 		case ZSYS_GetSerialNumber:
; 231  : 			//RETAILMSG(1, (TEXT("SYS_IOControl: ZSYS_GetSerialNumber\r\n")));
; 232  : 			memcpy((BYTE *)lpOutBuf, (BYTE *)SERIAL_NUMBER_STORE_ADDR, 24);
; 233  : 			return TRUE;
; 234  : 			
; 235  :         case ZSYS_GetBarcodePower:
; 236  : 
; 237  :             *(PBOOL)lpOutBuf = SysCtrl_BCRGetHWPower();
; 238  : 
; 239  :             *lpBytesReturned = sizeof(BOOL);
; 240  : 
; 241  :             return TRUE;
; 242  : 
; 243  : 
; 244  :         case ZSYS_SetBarcodePower:
; 245  : 
; 246  :             dwState = *(PBOOL)lpInBuf;
; 247  : 
; 248  :             return SysCtrl_BCRSetHWPower(dwState);
; 249  : 
; 250  : 		case ZSYS_GetBluetoothPower:
; 251  : 			*(PBOOL)lpOutBuf = (*(volatile BYTE *)DEVICE_POWER_FLAG_ADDR & BT_POWER_MASK) ? TRUE : FALSE;
; 252  : 			*lpBytesReturned = sizeof(BOOL);
; 253  : 			return TRUE;
; 254  : 
; 255  :         case ZSYS_SetBluetoothPower:
; 256  :             dwState = *(PBOOL)lpInBuf;
; 257  :             return BTSetHWPower(dwState);
; 258  :             
; 259  : 		case ZSYS_GetWIFIState:
; 260  : 			*(PBOOL)lpOutBuf= (*(volatile WORD *)BUILD_IN_DEVICE_FLAG_ADDR&WIFI_BUILD_IN_MASK)? TRUE : FALSE;
; 261  : 			*lpBytesReturned=sizeof(BOOL);
; 262  : 			return TRUE;	        
; 263  : 
; 264  : 		case ZSYS_ClearWIFIState:
; 265  : 			*(volatile WORD *)BUILD_IN_DEVICE_FLAG_ADDR&=~WIFI_BUILD_IN_MASK;
; 266  : 			return TRUE;
; 267  : 
; 268  : 		case ZSYS_GetRFIDPower:
; 269  :             *(PBOOL)lpOutBuf = RFIDGetHWPower();
; 270  :             *lpBytesReturned = sizeof(BOOL);
; 271  :             return TRUE;
; 272  : 
; 273  :         case ZSYS_SetRFIDPower:
; 274  :             dwState = *(PBOOL)lpInBuf;
; 275  :             //if( RFIDSetHWPower(dwState) ==  FALSE )
; 276  :             if( SysCtrl_BCRSetHWPower(dwState) ==  FALSE )
; 277  :             	return FALSE;
; 278  :             if( dwState )
; 279  :             {
; 280  :             	PXA_OST_DelayMilliSeconds(1000);
; 281  :             	if(	!ChkBuiltInRFID() )
; 282  :             	{
; 283  :             		PXA_OST_DelayMilliSeconds(1000);
; 284  :             		ChkBuiltInRFID();
; 285  :             	}
; 286  :             }
; 287  :             return TRUE;
; 288  :             
; 289  : 		case ZSYS_GetVIBRATORPower:
; 290  :             *(PBOOL)lpOutBuf = VibratorGetHWPower();
; 291  :             *lpBytesReturned = sizeof(BOOL);
; 292  :             return TRUE;
; 293  : 
; 294  :         case ZSYS_SetVIBRATORPower:
; 295  :             dwState = *(PBOOL)lpInBuf;
; 296  :             if( VibratorSetHWPower(dwState) ==  FALSE )
; 297  :             	return FALSE;            
; 298  :             return TRUE;
; 299  :             
; 300  :         case ZSYS_Run_SW_Reset:
; 301  :             KernelIoControl(IOCTL_HAL_REBOOT, NULL, 0, NULL, 0, NULL);
; 302  :             return FALSE;
; 303  :         
; 304  :         case ZSYS_BCR_HW_Trigger:
; 305  : 			dwState = *(PBOOL)lpInBuf;
; 306  : 			SysCtrl_BCR_HW_Trigger(dwState);
; 307  :             return TRUE;
; 308  : 
; 309  : 		case ZSYS_WRITE_FLASH:
; 310  : 			if(NANDInit==FALSE)
; 311  : 				NANDInit=FlashInit();
; 312  : 			if(NANDInit==FALSE)
; 313  : 				return FALSE;
; 314  : 			lpFPro = (uNandFLASH *)lpInBuf;
; 315  : 			if(lpFPro==NULL) 
; 316  : 				return FALSE;  
; 317  : 			//RETAILMSG(1, (TEXT("SYS_WRITE_FLASH : 0x%x - 0x%x\r\n"),lpFPro->Offset,lpFPro->DataSize));
; 318  : 			return WriteFlashData(lpFPro->Offset,lpFPro->DataSize,lpFPro->lpBuffer);
; 319  : 
; 320  : 		case ZSYS_READ_FLASH:
; 321  : 			//RETAILMSG(1, (TEXT("SYS_READ_FLASH\r\n")));
; 322  : 			if(NANDInit==FALSE)
; 323  : 				NANDInit = FlashInit();
; 324  : 			if(NANDInit==FALSE)
; 325  : 				return FALSE;
; 326  : 			lpNRead = (NandRead *)lpInBuf;
; 327  : 			if(lpNRead==NULL) 
; 328  : 				return FALSE;
; 329  : 			*lpBytesReturned=lpNRead->DataSize;
; 330  : 			//RETAILMSG(1, (TEXT("SYS_READ_FLASH : 0x%x - 0x%x\r\n"),lpNRead->Offset,lpNRead->DataSize));
; 331  : 			return ReadFlashData(lpNRead->Offset,lpNRead->DataSize,(PBYTE)lpOutBuf);	
; 332  : */
; 333  : //		default:
; 334  : 	//		return FALSE;
; 335  :     //}
; 336  : 
; 337  :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 338  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M32225|

			 ENDP  ; |?SYS_IOControl@@YAHKKPAXK0KPAK@Z|, SYS_IOControl

	END
