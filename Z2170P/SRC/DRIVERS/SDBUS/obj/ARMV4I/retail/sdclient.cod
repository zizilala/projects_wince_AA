; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\Z2170P\SRC\DRIVERS\SDBUS\sdclient.cpp
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "


  00000			 AREA	 |.bss|, NOINIT
|dwDeviceAccess| % 0x4

  00000			 AREA	 |.data|, DATA
|dwBusAccess| DCD 0x1
	EXPORT	|?GetHostContainer@CSDHostContainer@@SAPAV1@XZ| ; CSDHostContainer::GetHostContainer
	IMPORT	|?g_pSdContainer@CSDHostContainer@@0PAV1@A| ; CSDHostContainer::g_pSdContainer
; File c:\wince600\platform\z2170p\src\drivers\sdbus\sdbus.hpp

  00000			 AREA	 |.pdata|, PDATA
|$T35706| DCD	|$LN5@GetHostCon|
	DCD	0x40000400
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |?GetHostContainer@CSDHostContainer@@SAPAV1@XZ| PROC ; CSDHostContainer::GetHostContainer

; 207  :     static CSDHostContainer * GetHostContainer () { return g_pSdContainer; };

  00000		 |$LN5@GetHostCon|
  00000		 |$M35703|
  00000	e59f3004	 ldr         r3, [pc, #4]
  00004	e5930000	 ldr         r0, [r3]
  00008	e12fff1e	 bx          lr
  0000c		 |$LN6@GetHostCon|
  0000c		 |$LN7@GetHostCon|
  0000c	00000000	 DCD         |?g_pSdContainer@CSDHostContainer@@0PAV1@A|
  00010		 |$M35704|

			 ENDP  ; |?GetHostContainer@CSDHostContainer@@SAPAV1@XZ|, CSDHostContainer::GetHostContainer

	EXPORT	|SDC_Init|
	IMPORT	|?DriverInit@CSDHostContainer@@SAPAXPBG@Z| ; CSDHostContainer::DriverInit
; File c:\wince600\platform\z2170p\src\drivers\sdbus\sdclient.cpp

  00000			 AREA	 |.pdata|, PDATA
|$T35718| DCD	|$LN5@SDC_Init|
	DCD	0x40000401
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SDC_Init| PROC

; 47   : {

  00000		 |$LN5@SDC_Init|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004		 |$M35715|

; 48   :     LPCTSTR         pszActiveKey = (LPCTSTR) dwContext;
; 49   : 
; 50   :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDBusDriver: +SDC_Init\n")));
; 51   :     DWORD dwRet = (DWORD) CSDHostContainer::DriverInit((LPCTSTR) dwContext);

  00004	eb000000	 bl          |?DriverInit@CSDHostContainer@@SAPAXPBG@Z|

; 52   :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDBusDriver: Bus Driver instance created : 0x%08X ! -SDC_Init \n"), dwRet));
; 53   : 
; 54   :     // return pointer to bus driver object as a context
; 55   :     return (DWORD)dwRet;
; 56   : }

  00008	e49de004	 ldr         lr, [sp], #4
  0000c	e12fff1e	 bx          lr
  00010		 |$M35716|

			 ENDP  ; |SDC_Init|

	EXPORT	|SDC_PreDeinit|

  00000			 AREA	 |.pdata|, PDATA
|$T35727| DCD	|$LN5@SDC_PreDei|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SDC_PreDeinit| PROC

; 66   : {

  00000		 |$LN5@SDC_PreDei|
  00000		 |$M35724|

; 67   :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDBusDriver: +SDC_PreDeinit\n")));
; 68   : 
; 69   :     // Nothing to do here. Just make sure that the device manager won't
; 70   :     // call Deinit until everyone is out of SDC_IOControl.
; 71   : 
; 72   :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDBusDriver: -SDC_PreDeinit\n")));
; 73   :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 74   : }

  00004	e12fff1e	 bx          lr
  00008		 |$M35725|

			 ENDP  ; |SDC_PreDeinit|

	EXPORT	|SDC_Deinit|
	IMPORT	|?DriverDeInit@CSDHostContainer@@SAXPAX@Z| ; CSDHostContainer::DriverDeInit

  00000			 AREA	 |.pdata|, PDATA
|$T35737| DCD	|$LN5@SDC_Deinit|
	DCD	0x40000501
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SDC_Deinit| PROC

; 83   : {

  00000		 |$LN5@SDC_Deinit|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004		 |$M35734|

; 84   :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDBusDriver: +SDC_Deinit\n")));
; 85   :     CSDHostContainer::DriverDeInit((PVOID)hDeviceContext);

  00004	eb000000	 bl          |?DriverDeInit@CSDHostContainer@@SAXPAX@Z|

; 86   :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDBusDriver: -SDC_Deinit\n")));
; 87   :     return TRUE;

  00008	e3a00001	 mov         r0, #1

; 88   : }

  0000c	e49de004	 ldr         lr, [sp], #4
  00010	e12fff1e	 bx          lr
  00014		 |$M35735|

			 ENDP  ; |SDC_Deinit|

	EXPORT	|SDC_Open|
; File c:\wince600\platform\z2170p\src\drivers\sdbus\sdbus.hpp

  00000			 AREA	 |.pdata|, PDATA
|$T35751| DCD	|$LN10@SDC_Open|
	DCD	0x40000d00
; Function compile flags: /Ogspy
; File c:\wince600\platform\z2170p\src\drivers\sdbus\sdclient.cpp

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SDC_Open| PROC

; 106  : {

  00000		 |$LN10@SDC_Open|
  00000		 |$M35748|

; 107  :     HANDLE hRet = NULL ;
; 108  : 
; 109  :     DEBUGMSG(SDCARD_ZONE_FUNC, (TEXT("SDBusDriver: +-SDC_Open\n")));
; 110  :     
; 111  :     if (CSDHostContainer::GetHostContainer ()) {

  00000	e59f3028	 ldr         r3, [pc, #0x28]
  00004	e3a00000	 mov         r0, #0
  00008	e5933000	 ldr         r3, [r3]
  0000c	e3530000	 cmp         r3, #0
  00010	0a000003	 beq         |$LN1@SDC_Open|

; 112  :         if (AccessCode & DEVACCESS_BUSNAMESPACE) {

  00014	e3110c01	 tst         r1, #1, 24

; 113  :             // This is a bus access
; 114  :             hRet = (HANDLE)&dwBusAccess;

  00018	159f000c	 ldrne       r0, [pc, #0xC]

; 119  :         }
; 120  :     }
; 121  : 
; 122  :     return hRet;
; 123  : }

  0001c	112fff1e	 bxne        lr

; 115  :         }
; 116  :         else {
; 117  :             // Standard access
; 118  :             hRet = (HANDLE)&dwDeviceAccess;

  00020	e59f0000	 ldr         r0, [pc]
  00024		 |$LN1@SDC_Open|

; 119  :         }
; 120  :     }
; 121  : 
; 122  :     return hRet;
; 123  : }

  00024	e12fff1e	 bx          lr
  00028		 |$LN11@SDC_Open|
  00028		 |$LN12@SDC_Open|
  00028	00000000	 DCD         |dwDeviceAccess|
  0002c		 |$LN13@SDC_Open|
  0002c	00000000	 DCD         |dwBusAccess|
  00030		 |$LN14@SDC_Open|
  00030	00000000	 DCD         |?g_pSdContainer@CSDHostContainer@@0PAV1@A|
  00034		 |$M35749|

			 ENDP  ; |SDC_Open|

	EXPORT	|SDC_Close|

  00000			 AREA	 |.pdata|, PDATA
|$T35764| DCD	|$LN5@SDC_Close|
	DCD	0x40000200
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SDC_Close| PROC

; 132  : {

  00000		 |$LN5@SDC_Close|
  00000		 |$M35761|

; 133  :     DEBUGMSG(SDCARD_ZONE_FUNC, (TEXT("SDBusDriver: +-SDC_Close\n")));
; 134  : 
; 135  :     return TRUE;

  00000	e3a00001	 mov         r0, #1

; 136  : }

  00004	e12fff1e	 bx          lr
  00008		 |$M35762|

			 ENDP  ; |SDC_Close|

	EXPORT	|SDC_IOControl|
	IMPORT	|SetLastError|
; File c:\wince600\platform\z2170p\src\drivers\sdbus\sdbus.hpp

  00000			 AREA	 |.pdata|, PDATA
|$T35787| DCD	|$LN15@SDC_IOCont|
	DCD	0x40002802
; Function compile flags: /Ogspy
; File c:\wince600\platform\z2170p\src\drivers\sdbus\sdclient.cpp

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SDC_IOControl| PROC

; 158  : {

  00000		 |$LN15@SDC_IOCont|
  00000	e92d43f0	 stmdb       sp!, {r4 - r9, lr}
  00004	e24dd00c	 sub         sp, sp, #0xC
  00008		 |$M35784|
  00008	e1a09003	 mov         r9, r3

; 159  : 
; 160  :     DEBUGMSG(SDCARD_ZONE_FUNC, (TEXT("SDBusDriver: +SDC_IOControl\n")));
; 161  :     BOOL fRet = FALSE;
; 162  :     if (CSDHostContainer::GetHostContainer()!=NULL && hOpenContext!=NULL) {        

  0000c	e59fe088	 ldr         lr, [pc, #0x88]
  00010	e59e8000	 ldr         r8, [lr]
  00014	e3580000	 cmp         r8, #0
  00018	0a000019	 beq         |$LN4@SDC_IOCont|
  0001c	e3500000	 cmp         r0, #0
  00020	0a000017	 beq         |$LN4@SDC_IOCont|

; 163  :         if ((*(PDWORD)hOpenContext)!= 0 ) {

  00024	e590e000	 ldr         lr, [r0]

; 164  :             fRet = CSDHostContainer::GetHostContainer()->IOControl(dwCode, pBufIn, dwLenIn, pBufOut, dwLenOut, pdwActualOut);

  00028	e59d4030	 ldr         r4, [sp, #0x30]
  0002c	e59d502c	 ldr         r5, [sp, #0x2C]
  00030	e59d6028	 ldr         r6, [sp, #0x28]
  00034	e35e0000	 cmp         lr, #0
  00038	e1a00008	 mov         r0, r8
  0003c	0a000007	 beq         |$LN3@SDC_IOCont|
  00040	e598e000	 ldr         lr, [r8]
  00044	e58d4008	 str         r4, [sp, #8]
  00048	e58d5004	 str         r5, [sp, #4]
  0004c	e59e703c	 ldr         r7, [lr, #0x3C]
  00050	e58d6000	 str         r6, [sp]
  00054	e1a0e00f	 mov         lr, pc
  00058	e12fff17	 bx          r7

; 165  :         }
; 166  :         else {

  0005c	ea00000b	 b           |$LN1@SDC_IOCont|
  00060		 |$LN3@SDC_IOCont|

; 167  :             fRet = CSDHostContainer::GetHostContainer()->SDC_IOControl(dwCode, pBufIn, dwLenIn, pBufOut, dwLenOut, pdwActualOut);

  00060	e5983000	 ldr         r3, [r8]
  00064	e58d4008	 str         r4, [sp, #8]
  00068	e58d5004	 str         r5, [sp, #4]
  0006c	e593705c	 ldr         r7, [r3, #0x5C]
  00070	e1a03009	 mov         r3, r9
  00074	e58d6000	 str         r6, [sp]
  00078	e1a0e00f	 mov         lr, pc
  0007c	e12fff17	 bx          r7

; 168  :         }
; 169  :             
; 170  :     } 
; 171  :     else {

  00080	ea000002	 b           |$LN1@SDC_IOCont|
  00084		 |$LN4@SDC_IOCont|

; 172  :         SetLastError(ERROR_INVALID_PARAMETER);

  00084	e3a00057	 mov         r0, #0x57
  00088	eb000000	 bl          SetLastError

; 173  :         fRet = FALSE;

  0008c	e3a00000	 mov         r0, #0
  00090		 |$LN1@SDC_IOCont|

; 174  :     }
; 175  :     ASSERT(fRet);
; 176  :     return (fRet);
; 177  : }

  00090	e28dd00c	 add         sp, sp, #0xC
  00094	e8bd43f0	 ldmia       sp!, {r4 - r9, lr}
  00098	e12fff1e	 bx          lr
  0009c		 |$LN16@SDC_IOCont|
  0009c		 |$LN17@SDC_IOCont|
  0009c	00000000	 DCD         |?g_pSdContainer@CSDHostContainer@@0PAV1@A|
  000a0		 |$M35785|

			 ENDP  ; |SDC_IOControl|

	EXPORT	|SDHCDGetHCFunctions|
	IMPORT	|?SDHCDPowerUpDown__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@HHK@Z| ; CSDHostContainer::SDHCDPowerUpDown__X
	IMPORT	|?SDHCDGetAndLockCurrentRequest__X@CSDHostContainer@@SAPAU_SD_BUS_REQUEST@@PAU_SDCARD_HC_CONTEXT@@K@Z| ; CSDHostContainer::SDHCDGetAndLockCurrentRequest__X
	IMPORT	|?SDHCDUnlockRequest__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@PAU_SD_BUS_REQUEST@@@Z| ; CSDHostContainer::SDHCDUnlockRequest__X
	IMPORT	|?SDHCDIndicateBusRequestComplete__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@PAU_SD_BUS_REQUEST@@J@Z| ; CSDHostContainer::SDHCDIndicateBusRequestComplete__X
	IMPORT	|?SDHCDIndicateSlotStateChange__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@KW4_SD_SLOT_EVENT@@@Z| ; CSDHostContainer::SDHCDIndicateSlotStateChange__X
	IMPORT	|?SDHCDDeregisterHostController__X@CSDHostContainer@@SAJPAU_SDCARD_HC_CONTEXT@@@Z| ; CSDHostContainer::SDHCDDeregisterHostController__X
	IMPORT	|?SDHCDRegisterHostController__X@CSDHostContainer@@SAJPAU_SDCARD_HC_CONTEXT@@@Z| ; CSDHostContainer::SDHCDRegisterHostController__X
	IMPORT	|?SDHCDAllocateContext__X@CSDHostContainer@@SAJKPAPAU_SDCARD_HC_CONTEXT@@@Z| ; CSDHostContainer::SDHCDAllocateContext__X
	IMPORT	|?SDHCDDeleteContext__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@@Z| ; CSDHostContainer::SDHCDDeleteContext__X

  00000			 AREA	 |.pdata|, PDATA
|$T35800| DCD	|$LN7@SDHCDGetHC|
	DCD	0x40002301
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |SDHCDGetHCFunctions| PROC

; 187  : {

  00000		 |$LN7@SDHCDGetHC|
  00000	e92d41f0	 stmdb       sp!, {r4 - r8, lr}
  00004		 |$M35797|
  00004	e3500000	 cmp         r0, #0

; 188  :     SD_API_STATUS status = SD_API_STATUS_INVALID_PARAMETER;

  00008	e3a0211f	 mov         r2, #0x1F, 2

; 189  : 
; 190  :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDHCDGetHCFunctions: +Init\n")));
; 191  : 
; 192  :     if ( pFunctions && (pFunctions->dwSize == sizeof(*pFunctions)) ) {

  0000c	0a000012	 beq         |$LN2@SDHCDGetHC|
  00010	e5903000	 ldr         r3, [r0]
  00014	e3530028	 cmp         r3, #0x28
  00018	1a00000f	 bne         |$LN2@SDHCDGetHC|

; 193  :         pFunctions->pAllocateContext = &CSDHostContainer::SDHCDAllocateContext__X;
; 194  :         pFunctions->pDeleteContext = &CSDHostContainer::SDHCDDeleteContext__X;

  0001c	e59f2064	 ldr         r2, [pc, #0x64]
  00020	e59f305c	 ldr         r3, [pc, #0x5C]

; 195  :         pFunctions->pRegisterHostController = &CSDHostContainer::SDHCDRegisterHostController__X;

  00024	e59f1054	 ldr         r1, [pc, #0x54]

; 196  :         pFunctions->pDeregisterHostController = &CSDHostContainer::SDHCDDeregisterHostController__X;

  00028	e59fe04c	 ldr         lr, [pc, #0x4C]

; 197  :         pFunctions->pIndicateSlotStateChange = &CSDHostContainer::SDHCDIndicateSlotStateChange__X;

  0002c	e59f4044	 ldr         r4, [pc, #0x44]

; 198  :         pFunctions->pIndicateBusRequestComplete = &CSDHostContainer::SDHCDIndicateBusRequestComplete__X;

  00030	e59f503c	 ldr         r5, [pc, #0x3C]

; 199  :         pFunctions->pUnlockRequest = &CSDHostContainer::SDHCDUnlockRequest__X;

  00034	e59f6034	 ldr         r6, [pc, #0x34]

; 200  :         pFunctions->pGetAndLockCurrentRequest = &CSDHostContainer::SDHCDGetAndLockCurrentRequest__X;

  00038	e59f702c	 ldr         r7, [pc, #0x2C]

; 201  :         pFunctions->pPowerUpDown = &CSDHostContainer::SDHCDPowerUpDown__X;

  0003c	e59f8024	 ldr         r8, [pc, #0x24]
  00040	e5802008	 str         r2, [r0, #8]

; 202  : 
; 203  :         status = SD_API_STATUS_SUCCESS;

  00044	e3a02000	 mov         r2, #0
  00048	e5803004	 str         r3, [r0, #4]
  0004c	e280c00c	 add         r12, r0, #0xC
  00050	e88c4002	 stmia       r12, {r1, lr}
  00054	e280c014	 add         r12, r0, #0x14
  00058	e88c01f0	 stmia       r12, {r4 - r8}
  0005c		 |$LN2@SDHCDGetHC|

; 204  :     }
; 205  :     else {
; 206  :         DEBUGMSG(SDCARD_ZONE_ERROR, (TEXT("SDHCDGetHCFunctions: Invalid parameter\n")));
; 207  :     }
; 208  : 
; 209  :     DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDHCDGetHCFunctions: -Init\n")));
; 210  : 
; 211  :     return status;
; 212  : }

  0005c	e1a00002	 mov         r0, r2
  00060	e8bd41f0	 ldmia       sp!, {r4 - r8, lr}
  00064	e12fff1e	 bx          lr
  00068		 |$LN8@SDHCDGetHC|
  00068		 |$LN9@SDHCDGetHC|
  00068	00000000	 DCD         |?SDHCDPowerUpDown__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@HHK@Z|
  0006c		 |$LN10@SDHCDGetHC|
  0006c	00000000	 DCD         |?SDHCDGetAndLockCurrentRequest__X@CSDHostContainer@@SAPAU_SD_BUS_REQUEST@@PAU_SDCARD_HC_CONTEXT@@K@Z|
  00070		 |$LN11@SDHCDGetHC|
  00070	00000000	 DCD         |?SDHCDUnlockRequest__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@PAU_SD_BUS_REQUEST@@@Z|
  00074		 |$LN12@SDHCDGetHC|
  00074	00000000	 DCD         |?SDHCDIndicateBusRequestComplete__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@PAU_SD_BUS_REQUEST@@J@Z|
  00078		 |$LN13@SDHCDGetHC|
  00078	00000000	 DCD         |?SDHCDIndicateSlotStateChange__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@KW4_SD_SLOT_EVENT@@@Z|
  0007c		 |$LN14@SDHCDGetHC|
  0007c	00000000	 DCD         |?SDHCDDeregisterHostController__X@CSDHostContainer@@SAJPAU_SDCARD_HC_CONTEXT@@@Z|
  00080		 |$LN15@SDHCDGetHC|
  00080	00000000	 DCD         |?SDHCDRegisterHostController__X@CSDHostContainer@@SAJPAU_SDCARD_HC_CONTEXT@@@Z|
  00084		 |$LN16@SDHCDGetHC|
  00084	00000000	 DCD         |?SDHCDAllocateContext__X@CSDHostContainer@@SAJKPAPAU_SDCARD_HC_CONTEXT@@@Z|
  00088		 |$LN17@SDHCDGetHC|
  00088	00000000	 DCD         |?SDHCDDeleteContext__X@CSDHostContainer@@SAXPAU_SDCARD_HC_CONTEXT@@@Z|
  0008c		 |$M35798|

			 ENDP  ; |SDHCDGetHCFunctions|

	EXPORT	|DllEntry|
	IMPORT	|DisableThreadLibraryCalls|

  00000			 AREA	 |.pdata|, PDATA
|$T35821| DCD	|$LN8@DllEntry|
	DCD	0x40000601
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |DllEntry| PROC

; 227  : {

  00000		 |$LN8@DllEntry|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004		 |$M35818|

; 228  :     BOOL fRet = TRUE;
; 229  : 
; 230  :     if ( Reason == DLL_PROCESS_ATTACH ) {

  00004	e3510001	 cmp         r1, #1

; 231  :         DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDBusDriver: PROCESS_ATTACH \n")));
; 232  :         DisableThreadLibraryCalls((HMODULE) hInstance);

  00008	0b000000	 bleq        DisableThreadLibraryCalls

; 233  :         SD_DEBUG_ZONE_REGISTER(hInstance, NULL);
; 234  :     }
; 235  :     else if ( Reason == DLL_PROCESS_DETACH ) {
; 236  :         DEBUGMSG(SDCARD_ZONE_INIT, (TEXT("SDBusDriver: PROCESS_DETACH \n")));
; 237  :     }
; 238  : 
; 239  :     return fRet;

  0000c	e3a00001	 mov         r0, #1

; 240  : }

  00010	e49de004	 ldr         lr, [sp], #4
  00014	e12fff1e	 bx          lr
  00018		 |$M35819|

			 ENDP  ; |DllEntry|

	END
