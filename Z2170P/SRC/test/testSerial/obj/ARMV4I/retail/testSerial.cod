; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\Z2170P\SRC\test\testSerial\testSerial.cpp
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-INCLUDE:__@@_PchSym_@00@UdrmxvGAAUkozgulinUaCBHAkUhixUg"
	DCB	"vhgUgvhghvirzoUlyqUzineErUivgzroUhgwzucOlyq@testSerial "
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "

	EXPORT	|__$ArrayPad$| [ DATA ]
	EXPORT	|wmain|
	EXPORT	|??_C@_1EE@HLMNFNHG@?$AA?$CI?$AAn?$AAb?$AAW?$AAr?$AAi?$AAt?$AAt?$AAe?$AAn?$AA?5?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AA?$CB?$AA?$DN?$AA?5?$AAn?$AAb?$AAR?$AAe?$AAa?$AAd?$AA?5?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?$CJ?$AA?$AN@| [ DATA ] ; `string'
	EXPORT	|??_C@_1BI@GLMPOJKD@?$AAO?$AAp?$AAe?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAs?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1HO@GHMNOFKG@?$AAI?$AAn?$AAv?$AAa?$AAl?$AAi?$AAd?$AA?5?$AAn?$AAu?$AAm?$AAb?$AAe?$AAr?$AA?5?$AAo?$AAf?$AA?5?$AAp?$AAa?$AAr?$AAa?$AAm?$AAe?$AAt?$AAe?$AAr?$AAs?$AA?6?$AAu?$AAs?$AAa@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DC@NBECIGLP@?$AAS?$AAi?$AAm?$AAp?$AAl?$AAe?$AA?5?$AAE?$AAc?$AAh?$AAo?$AA?5?$AAa?$AAp?$AAp?$AAl?$AAi?$AAc?$AAa?$AAt?$AAi?$AAo?$AAn?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	IMPORT	|NKDbgPrintfW|
	IMPORT	|WriteFile|
	IMPORT	|ReadFile|
	IMPORT	|SetCommTimeouts|
	IMPORT	|GetCommTimeouts|
	IMPORT	|SetCommState|
	IMPORT	|GetCommState|
	IMPORT	|CreateFileW|
	IMPORT	|wprintf|
	IMPORT	|__GSHandlerCheck|
	IMPORT	|__security_cookie|
	IMPORT	|__security_check_cookie|
; File c:\wince600\platform\z2170p\src\test\testserial\testserial.cpp

  00000			 AREA	 |.pdata|, PDATA
|$T32075| DCD	|$LN14@wmain|
	DCD	0xc0006302

  00000			 AREA	 |.xdata|, DATA
|$T32071| DCD	0xffffffe8

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EE@HLMNFNHG@?$AA?$CI?$AAn?$AAb?$AAW?$AAr?$AAi?$AAt?$AAt?$AAe?$AAn?$AA?5?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AA?$CB?$AA?$DN?$AA?5?$AAn?$AAb?$AAR?$AAe?$AAa?$AAd?$AA?5?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?$CJ?$AA?$AN@| DCB "("
	DCB	0x0, "n", 0x0, "b", 0x0, "W", 0x0, "r", 0x0, "i", 0x0, "t"
	DCB	0x0, "t", 0x0, "e", 0x0, "n", 0x0, " ", 0x0, "(", 0x0, "%"
	DCB	0x0, "d", 0x0, ")", 0x0, " ", 0x0, "!", 0x0, "=", 0x0, " "
	DCB	0x0, "n", 0x0, "b", 0x0, "R", 0x0, "e", 0x0, "a", 0x0, "d"
	DCB	0x0, " ", 0x0, "(", 0x0, "%", 0x0, "d", 0x0, ")", 0x0, ")"
	DCB	0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0	; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1BI@GLMPOJKD@?$AAO?$AAp?$AAe?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAs?$AA?6?$AA?$AA@| DCB "O"
	DCB	0x0, "p", 0x0, "e", 0x0, "n", 0x0, "i", 0x0, "n", 0x0, "g"
	DCB	0x0, " ", 0x0, "%", 0x0, "s", 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1HO@GHMNOFKG@?$AAI?$AAn?$AAv?$AAa?$AAl?$AAi?$AAd?$AA?5?$AAn?$AAu?$AAm?$AAb?$AAe?$AAr?$AA?5?$AAo?$AAf?$AA?5?$AAp?$AAa?$AAr?$AAa?$AAm?$AAe?$AAt?$AAe?$AAr?$AAs?$AA?6?$AAu?$AAs?$AAa@| DCB "I"
	DCB	0x0, "n", 0x0, "v", 0x0, "a", 0x0, "l", 0x0, "i", 0x0, "d"
	DCB	0x0, " ", 0x0, "n", 0x0, "u", 0x0, "m", 0x0, "b", 0x0, "e"
	DCB	0x0, "r", 0x0, " ", 0x0, "o", 0x0, "f", 0x0, " ", 0x0, "p"
	DCB	0x0, "a", 0x0, "r", 0x0, "a", 0x0, "m", 0x0, "e", 0x0, "t"
	DCB	0x0, "e", 0x0, "r", 0x0, "s", 0x0, 0xa, 0x0, "u", 0x0, "s"
	DCB	0x0, "a", 0x0, "g", 0x0, "e", 0x0, ":", 0x0, "%", 0x0, "s"
	DCB	0x0, " ", 0x0, "p", 0x0, "o", 0x0, "r", 0x0, "t", 0x0, "_"
	DCB	0x0, "n", 0x0, "a", 0x0, "m", 0x0, "e", 0x0, " ", 0x0, "("
	DCB	0x0, "e", 0x0, "x", 0x0, ":", 0x0, "%", 0x0, "s", 0x0, " "
	DCB	0x0, "C", 0x0, "O", 0x0, "M", 0x0, "1", 0x0, ":", 0x0, ")"
	DCB	0x0, 0xa, 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DC@NBECIGLP@?$AAS?$AAi?$AAm?$AAp?$AAl?$AAe?$AA?5?$AAE?$AAc?$AAh?$AAo?$AA?5?$AAa?$AAp?$AAp?$AAl?$AAi?$AAc?$AAa?$AAt?$AAi?$AAo?$AAn?$AA?6?$AA?$AA@| DCB "S"
	DCB	0x0, "i", 0x0, "m", 0x0, "p", 0x0, "l", 0x0, "e", 0x0, " "
	DCB	0x0, "E", 0x0, "c", 0x0, "h", 0x0, "o", 0x0, " ", 0x0, "a"
	DCB	0x0, "p", 0x0, "p", 0x0, "l", 0x0, "i", 0x0, "c", 0x0, "a"
	DCB	0x0, "t", 0x0, "i", 0x0, "o", 0x0, "n", 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000	00000000	 DCD         |__GSHandlerCheck|
  00004	00000000	 DCD         |$T32071|

  00008		 |wmain| PROC

; 8    : {    

  00008		 |$LN14@wmain|
  00008	e92d40f0	 stmdb       sp!, {r4 - r7, lr}
  0000c	e24ddf92	 sub         sp, sp, #0x92, 30
  00010		 |$M32072|
  00010	e1a05001	 mov         r5, r1
  00014	e1a04000	 mov         r4, r0
  00018	e59f3170	 ldr         r3, [pc, #0x170]
  0001c	e5933000	 ldr         r3, [r3]
  00020	e58d3244	 str         r3, [sp, #0x244]

; 9    :     HANDLE h;
; 10   :     DCB dcb;
; 11   :     COMMTIMEOUTS		timeouts;
; 12   :     _tprintf(_T("Simple Echo application\n"));

  00024	e59f0160	 ldr         r0, [pc, #0x160]
  00028	eb000000	 bl          wprintf

; 13   :     if (argc != 2)

  0002c	e3540002	 cmp         r4, #2
  00030	0a000009	 beq         |$LN5@wmain|

; 14   :     {
; 15   :         _tprintf(_T("Invalid number of parameters\nusage:%s port_name (ex:%s COM1:)\n"),argv[0],argv[0]);

  00034	e5951000	 ldr         r1, [r5]
  00038	e59f0148	 ldr         r0, [pc, #0x148]
  0003c	e1a02001	 mov         r2, r1
  00040	eb000000	 bl          wprintf

; 16   :         return -1;

  00044	e59d0244	 ldr         r0, [sp, #0x244]
  00048	eb000000	 bl          __security_check_cookie
  0004c	e3e00000	 mvn         r0, #0

; 60   :     CloseHandle(h);
; 61   :     return 0;
; 62   : }

  00050	e28ddf92	 add         sp, sp, #0x92, 30
  00054	e8bd40f0	 ldmia       sp!, {r4 - r7, lr}
  00058	e12fff1e	 bx          lr
  0005c		 |$LN5@wmain|

; 17   :     }
; 18   :     _tprintf(_T("Opening %s\n"),argv[1]);

  0005c	e5951004	 ldr         r1, [r5, #4]
  00060	e59f011c	 ldr         r0, [pc, #0x11C]
  00064	eb000000	 bl          wprintf

; 19   :     h = CreateFile(argv[1],GENERIC_READ | GENERIC_WRITE,0,NULL,OPEN_EXISTING,0,NULL);

  00068	e5950004	 ldr         r0, [r5, #4]
  0006c	e3a0e003	 mov         lr, #3
  00070	e3a07000	 mov         r7, #0
  00074	e3a03000	 mov         r3, #0
  00078	e3a02000	 mov         r2, #0
  0007c	e3a01103	 mov         r1, #3, 2
  00080	e58de000	 str         lr, [sp]
  00084	e58d7008	 str         r7, [sp, #8]
  00088	e58d7004	 str         r7, [sp, #4]
  0008c	eb000000	 bl          CreateFileW

; 20   :     GetCommState(h,&dcb);

  00090	e28d1028	 add         r1, sp, #0x28
  00094	e1a04000	 mov         r4, r0
  00098	eb000000	 bl          GetCommState

; 21   :     dcb.BaudRate = 115200;   
; 22   :     dcb.fBinary          = TRUE;
; 23   :     dcb.fParity          = FALSE;
; 24   :     dcb.fOutxCtsFlow     = FALSE;
; 25   :     dcb.fOutxDsrFlow     = FALSE;
; 26   :     dcb.fDtrControl      = DTR_CONTROL_DISABLE;
; 27   :     dcb.fDsrSensitivity  = FALSE;
; 28   :     dcb.fOutX            = FALSE;
; 29   :     dcb.fInX             = FALSE;
; 30   :     dcb.fErrorChar       = 0;    
; 31   :     dcb.fNull            = 0;    
; 32   :     dcb.fRtsControl      = RTS_CONTROL_ENABLE;

  0009c	e59d2030	 ldr         r2, [sp, #0x30]
  000a0	e3e03c6f	 mvn         r3, #0x6F, 24
  000a4	e223307e	 eor         r3, r3, #0x7E
  000a8	e3a01a01	 mov         r1, #1, 20
  000ac	e0022003	 and         r2, r2, r3
  000b0	e3813001	 orr         r3, r1, #1
  000b4	e3a00907	 mov         r0, #7, 18
  000b8	e1823003	 orr         r3, r2, r3
  000bc	e3802c02	 orr         r2, r0, #2, 24

; 33   :     dcb.fAbortOnError    = FALSE;
; 34   :     dcb.ByteSize         = 8;    

  000c0	e3a0e008	 mov         lr, #8

; 35   :     dcb.Parity           = NOPARITY;

  000c4	e3a05000	 mov         r5, #0

; 36   :     dcb.StopBits         = ONESTOPBIT;

  000c8	e3a06000	 mov         r6, #0

; 37   :     SetCommState(h,&dcb);

  000cc	e1a00004	 mov         r0, r4
  000d0	e28d1028	 add         r1, sp, #0x28
  000d4	e58d202c	 str         r2, [sp, #0x2C]
  000d8	e58d3030	 str         r3, [sp, #0x30]
  000dc	e5cde03a	 strb        lr, [sp, #0x3A]
  000e0	e5cd503b	 strb        r5, [sp, #0x3B]
  000e4	e5cd603c	 strb        r6, [sp, #0x3C]
  000e8	eb000000	 bl          SetCommState

; 38   : 
; 39   :     GetCommTimeouts(h,&timeouts);

  000ec	e28d1014	 add         r1, sp, #0x14
  000f0	e1a00004	 mov         r0, r4
  000f4	eb000000	 bl          GetCommTimeouts

; 40   :     timeouts.ReadIntervalTimeout = 100;
; 41   :     timeouts.ReadTotalTimeoutMultiplier = 10;
; 42   :     timeouts.ReadTotalTimeoutConstant = 1000;

  000f8	e3a01ffa	 mov         r1, #0xFA, 30

; 43   :     timeouts.WriteTotalTimeoutMultiplier = 10;

  000fc	e3a0000a	 mov         r0, #0xA

; 44   :     timeouts.WriteTotalTimeoutConstant = 1000;

  00100	e58d101c	 str         r1, [sp, #0x1C]
  00104	e58d0020	 str         r0, [sp, #0x20]
  00108	e3a03064	 mov         r3, #0x64
  0010c	e3a0200a	 mov         r2, #0xA
  00110	e3a0effa	 mov         lr, #0xFA, 30

; 45   :     SetCommTimeouts(h,&timeouts);

  00114	e28d1014	 add         r1, sp, #0x14
  00118	e1a00004	 mov         r0, r4
  0011c	e58d3014	 str         r3, [sp, #0x14]
  00120	e58d2018	 str         r2, [sp, #0x18]
  00124	e58de024	 str         lr, [sp, #0x24]
  00128	eb000000	 bl          SetCommTimeouts
  0012c		 |$LL4@wmain|

; 46   : 
; 47   :     for(;;)
; 48   :     {
; 49   :         UCHAR buffer[512];
; 50   :         DWORD nbRead,nbWritten;
; 51   :         if (ReadFile(h,buffer,sizeof(buffer),&nbRead,NULL))

  0012c	e28d300c	 add         r3, sp, #0xC
  00130	e3a02c02	 mov         r2, #2, 24
  00134	e28d1044	 add         r1, sp, #0x44
  00138	e1a00004	 mov         r0, r4
  0013c	e58d7000	 str         r7, [sp]
  00140	eb000000	 bl          ReadFile
  00144	e3500000	 cmp         r0, #0
  00148	0afffff7	 beq         |$LL4@wmain|

; 52   :         {
; 53   :             WriteFile(h,buffer,nbRead,&nbWritten,NULL);

  0014c	e59d200c	 ldr         r2, [sp, #0xC]
  00150	e28d3010	 add         r3, sp, #0x10
  00154	e28d1044	 add         r1, sp, #0x44
  00158	e1a00004	 mov         r0, r4
  0015c	e58d7000	 str         r7, [sp]
  00160	eb000000	 bl          WriteFile

; 54   :             if (nbWritten != nbRead)

  00164	e59d1010	 ldr         r1, [sp, #0x10]
  00168	e59d200c	 ldr         r2, [sp, #0xC]
  0016c	e1510002	 cmp         r1, r2
  00170	0affffed	 beq         |$LL4@wmain|

; 55   :             {
; 56   :                 RETAILMSG(1,(TEXT("(nbWritten (%d) != nbRead (%d))\r\n"),nbWritten,nbRead));

  00174	e59f0004	 ldr         r0, [pc, #4]
  00178	eb000000	 bl          NKDbgPrintfW

; 57   :             }
; 58   :         }
; 59   :     }

  0017c	eaffffea	 b           |$LL4@wmain|
  00180		 |$LN15@wmain|
  00180		 |$LN16@wmain|
  00180	00000000	 DCD         |??_C@_1EE@HLMNFNHG@?$AA?$CI?$AAn?$AAb?$AAW?$AAr?$AAi?$AAt?$AAt?$AAe?$AAn?$AA?5?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AA?$CB?$AA?$DN?$AA?5?$AAn?$AAb?$AAR?$AAe?$AAa?$AAd?$AA?5?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?$CJ?$AA?$AN@|
  00184		 |$LN17@wmain|
  00184	00000000	 DCD         |??_C@_1BI@GLMPOJKD@?$AAO?$AAp?$AAe?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAs?$AA?6?$AA?$AA@|
  00188		 |$LN18@wmain|
  00188	00000000	 DCD         |??_C@_1HO@GHMNOFKG@?$AAI?$AAn?$AAv?$AAa?$AAl?$AAi?$AAd?$AA?5?$AAn?$AAu?$AAm?$AAb?$AAe?$AAr?$AA?5?$AAo?$AAf?$AA?5?$AAp?$AAa?$AAr?$AAa?$AAm?$AAe?$AAt?$AAe?$AAr?$AAs?$AA?6?$AAu?$AAs?$AAa@|
  0018c		 |$LN19@wmain|
  0018c	00000000	 DCD         |??_C@_1DC@NBECIGLP@?$AAS?$AAi?$AAm?$AAp?$AAl?$AAe?$AA?5?$AAE?$AAc?$AAh?$AAo?$AA?5?$AAa?$AAp?$AAp?$AAl?$AAi?$AAc?$AAa?$AAt?$AAi?$AAo?$AAn?$AA?6?$AA?$AA@|
  00190		 |$LN20@wmain|
  00190	00000000	 DCD         |__security_cookie|
  00194		 |$M32073|

			 ENDP  ; |wmain|

	END
