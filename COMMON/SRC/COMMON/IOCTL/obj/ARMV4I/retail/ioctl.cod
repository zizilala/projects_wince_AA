; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\COMMON\SRC\COMMON\IOCTL\ioctl.c
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "


  00000			 AREA	 |.bss|, NOINIT
|g_ioctlState| % 0x18

  00000			 AREA	 |.rdata|, DATA, READONLY
|EdbgVendorIds| DCW 0x0
	DCW	0x0
	DCD	0x4033
	DCB	0x1
	DCB	"AD", 0x0
	DCW	0x1050
	DCW	0x940
	DCD	0x4005
	DCB	0x1
	DCB	"LS", 0x0
	DCW	0x1050
	DCW	0x940
	DCD	0x2078
	DCB	0x1
	DCB	"LS", 0x0
	DCW	0x10ec
	DCW	0x8029
	DCD	0xc0f0
	DCB	0x1
	DCB	"KS", 0x0
	DCW	0x10ec
	DCW	0x8129
	DCD	0x0
	DCB	0x4
	DCB	"RT", 0x0
	DCW	0x10ec
	DCW	0x8139
	DCD	0x900b
	DCB	0x4
	DCB	"RT", 0x0
	DCW	0x10ec
	DCW	0x8139
	DCD	0xd0c9
	DCB	0x4
	DCB	"RT", 0x0
	DCW	0x10ec
	DCW	0x8139
	DCD	0xe04c
	DCB	0x4
	DCB	"RT", 0x0
	DCW	0x1186
	DCW	0x1300
	DCD	0x50ba
	DCB	0x4
	DCB	"DL", 0x0
	DCW	0x100b
	DCW	0x20
	DCD	0xa0cc
	DCB	0x5
	DCB	"NG", 0x0
	DCW	0x10b7
	DCW	0x9050
	DCD	0x6008
	DCB	0x6
	DCB	"3C", 0x0
	DCW	0x10b7
	DCW	0x9200
	DCD	0x476
	DCB	0x6
	DCB	"3C", 0x0
	EXPORT	|OEMIoControl|
	EXPORT	|??_C@_1DC@EGGJEANK@?$AA?9?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?$CI?$AAr?$AAc?$AA?5?$AA?$DN?$AA?5?$AA?$CF?$AAd?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1HM@LHHDIECD@?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?3?$AA?5?$AAU?$AAn?$AAs?$AAu?$AAp?$AAp?$AAo?$AAr?$AAt?$AAe?$AAd?$AA?5?$AAC?$AAo?$AAd?$AAe?$AA?5?$AA0@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GA@KJDOLNLD@?$AA?$CL?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?$CI?$AA0?$AAx?$AA?$CF?$AAx?$AA?0?$AA?5?$AA0?$AAx?$AA?$CF?$AAx?$AA?0?$AA?5?$AA?$CF?$AAd?$AA?0?$AA?5?$AA0?$AAx@| [ DATA ] ; `string'
	IMPORT	|LeaveCriticalSection|
	IMPORT	|EnterCriticalSection|
	IMPORT	|NKSetLastError|
	IMPORT	|InitializeCriticalSection|
	IMPORT	|NKDbgPrintfW|
	IMPORT	|dpCurSettings|
	IMPORT	|g_oalIoCtlTable|
; File c:\wince600\platform\common\src\common\ioctl\ioctl.c

  00000			 AREA	 |.pdata|, PDATA
|$T43086| DCD	|$LN24@OEMIoContr|
	DCD	0x40006b02

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DC@EGGJEANK@?$AA?9?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?$CI?$AAr?$AAc?$AA?5?$AA?$DN?$AA?5?$AA?$CF?$AAd?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@| DCB "-"
	DCB	0x0, "O", 0x0, "E", 0x0, "M", 0x0, "I", 0x0, "o", 0x0, "C"
	DCB	0x0, "o", 0x0, "n", 0x0, "t", 0x0, "r", 0x0, "o", 0x0, "l"
	DCB	0x0, "(", 0x0, "r", 0x0, "c", 0x0, " ", 0x0, "=", 0x0, " "
	DCB	0x0, "%", 0x0, "d", 0x0, ")", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1HM@LHHDIECD@?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?3?$AA?5?$AAU?$AAn?$AAs?$AAu?$AAp?$AAp?$AAo?$AAr?$AAt?$AAe?$AAd?$AA?5?$AAC?$AAo?$AAd?$AAe?$AA?5?$AA0@| DCB "O"
	DCB	0x0, "E", 0x0, "M", 0x0, "I", 0x0, "o", 0x0, "C", 0x0, "o"
	DCB	0x0, "n", 0x0, "t", 0x0, "r", 0x0, "o", 0x0, "l", 0x0, ":"
	DCB	0x0, " ", 0x0, "U", 0x0, "n", 0x0, "s", 0x0, "u", 0x0, "p"
	DCB	0x0, "p", 0x0, "o", 0x0, "r", 0x0, "t", 0x0, "e", 0x0, "d"
	DCB	0x0, " ", 0x0, "C", 0x0, "o", 0x0, "d", 0x0, "e", 0x0, " "
	DCB	0x0, "0", 0x0, "x", 0x0, "%", 0x0, "x", 0x0, " ", 0x0, "-"
	DCB	0x0, " ", 0x0, "d", 0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c"
	DCB	0x0, "e", 0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0"
	DCB	0x0, "4", 0x0, "x", 0x0, " ", 0x0, "f", 0x0, "u", 0x0, "n"
	DCB	0x0, "c", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa
	DCB	0x0, 0x0, 0x0				; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GA@KJDOLNLD@?$AA?$CL?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?$CI?$AA0?$AAx?$AA?$CF?$AAx?$AA?0?$AA?5?$AA0?$AAx?$AA?$CF?$AAx?$AA?0?$AA?5?$AA?$CF?$AAd?$AA?0?$AA?5?$AA0?$AAx@| DCB "+"
	DCB	0x0, "O", 0x0, "E", 0x0, "M", 0x0, "I", 0x0, "o", 0x0, "C"
	DCB	0x0, "o", 0x0, "n", 0x0, "t", 0x0, "r", 0x0, "o", 0x0, "l"
	DCB	0x0, "(", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "x", 0x0, ","
	DCB	0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "x", 0x0, ","
	DCB	0x0, " ", 0x0, "%", 0x0, "d", 0x0, ",", 0x0, " ", 0x0, "0"
	DCB	0x0, "x", 0x0, "%", 0x0, "x", 0x0, ",", 0x0, " ", 0x0, "%"
	DCB	0x0, "d", 0x0, ",", 0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%"
	DCB	0x0, "x", 0x0, ")", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OEMIoControl| PROC

; 45   : ) {

  00000		 |$LN24@OEMIoContr|
  00000	e92d4ff0	 stmdb       sp!, {r4 - r11, lr}
  00004	e24dd00c	 sub         sp, sp, #0xC
  00008		 |$M43083|
  00008	e1a09003	 mov         r9, r3
  0000c	e1a0a002	 mov         r10, r2
  00010	e1a0b001	 mov         r11, r1
  00014	e1a06000	 mov         r6, r0

; 46   :     BOOL rc = FALSE;
; 47   :     UINT32 i;
; 48   : 
; 49   :     OALMSG(OAL_IOCTL&&OAL_FUNC, (
; 50   :         L"+OEMIoControl(0x%x, 0x%x, %d, 0x%x, %d, 0x%x)\r\n", 
; 51   :         code, pInBuffer, inSize, pOutBuffer, outSize, pOutSize
; 52   :     ));

  00018	e59f8188	 ldr         r8, [pc, #0x188]
  0001c	e59de034	 ldr         lr, [sp, #0x34]
  00020	e59d5030	 ldr         r5, [sp, #0x30]
  00024	e5980440	 ldr         r0, [r8, #0x440]
  00028	e3a04000	 mov         r4, #0
  0002c	e3100a01	 tst         r0, #1, 20
  00030	13100004	 tstne       r0, #4
  00034	159f0168	 ldrne       r0, [pc, #0x168]
  00038	11a0300a	 movne       r3, r10
  0003c	11a0200b	 movne       r2, r11
  00040	11a01006	 movne       r1, r6
  00044	158de008	 strne       lr, [sp, #8]
  00048	158d5004	 strne       r5, [sp, #4]
  0004c	158d9000	 strne       r9, [sp]
  00050	1b000000	 blne        NKDbgPrintfW

; 53   : 
; 54   :     //Initialize g_ioctlState.cs when IOCTL_HAL_POSTINIT is called. By this time, 
; 55   :     //the kernel is up and ready to handle the critical section initialization.
; 56   :     if (!g_ioctlState.postInit && code == IOCTL_HAL_POSTINIT) {

  00054	e59f5144	 ldr         r5, [pc, #0x144]
  00058	e5952000	 ldr         r2, [r5]
  0005c	e3520000	 cmp         r2, #0
  00060	1a000006	 bne         |$LN8@OEMIoContr|
  00064	e59f3130	 ldr         r3, [pc, #0x130]
  00068	e1560003	 cmp         r6, r3
  0006c	1a000003	 bne         |$LN8@OEMIoContr|

; 57   :         // Initialize critical section
; 58   :         InitializeCriticalSection(&g_ioctlState.cs);

  00070	e2850004	 add         r0, r5, #4
  00074	eb000000	 bl          InitializeCriticalSection

; 59   :         g_ioctlState.postInit = TRUE;

  00078	e3a02001	 mov         r2, #1
  0007c	e5852000	 str         r2, [r5]
  00080		 |$LN8@OEMIoContr|

; 60   :     } 
; 61   : 
; 62   :     // Search the IOCTL table for the requested code.
; 63   :     for (i = 0; g_oalIoCtlTable[i].pfnHandler != NULL; i++) {

  00080	e59f0110	 ldr         r0, [pc, #0x110]
  00084	e3a01000	 mov         r1, #0
  00088	e5903008	 ldr         r3, [r0, #8]
  0008c	e3530000	 cmp         r3, #0
  00090	0a00000a	 beq         |$LN21@OEMIoContr|
  00094	e3a0e000	 mov         lr, #0
  00098		 |$LL7@OEMIoContr|

; 64   :         if (g_oalIoCtlTable[i].code == code) break;

  00098	e79e3000	 ldr         r3, [lr, +r0]
  0009c	e1530006	 cmp         r3, r6
  000a0	0a000006	 beq         |$LN21@OEMIoContr|
  000a4	e2811001	 add         r1, r1, #1
  000a8	e0813081	 add         r3, r1, r1, lsl #1
  000ac	e1a0e103	 mov         lr, r3, lsl #2
  000b0	e08e3000	 add         r3, lr, r0
  000b4	e5933008	 ldr         r3, [r3, #8]
  000b8	e3530000	 cmp         r3, #0
  000bc	1afffff5	 bne         |$LL7@OEMIoContr|
  000c0		 |$LN21@OEMIoContr|

; 65   :     }
; 66   : 
; 67   :     // Indicate unsupported code
; 68   :     if (g_oalIoCtlTable[i].pfnHandler == NULL) {

  000c0	e0813081	 add         r3, r1, r1, lsl #1
  000c4	e0807103	 add         r7, r0, r3, lsl #2
  000c8	e5973008	 ldr         r3, [r7, #8]
  000cc	e3530000	 cmp         r3, #0
  000d0	1a00000b	 bne         |$LN3@OEMIoContr|

; 69   :         NKSetLastError(ERROR_NOT_SUPPORTED);

  000d4	e3a00032	 mov         r0, #0x32
  000d8	eb000000	 bl          NKSetLastError

; 70   :         OALMSG(OAL_IOCTL, (
; 71   :             L"OEMIoControl: Unsupported Code 0x%x - device 0x%04x func %d\r\n", 
; 72   :             code, code >> 16, (code >> 2)&0x0FFF
; 73   :         ));

  000dc	e5983440	 ldr         r3, [r8, #0x440]
  000e0	e3130a01	 tst         r3, #1, 20
  000e4	0a00001f	 beq         |$cleanUp$43040|
  000e8	e59f00a4	 ldr         r0, [pc, #0xA4]
  000ec	e1a03906	 mov         r3, r6, lsl #18
  000f0	e1a03a23	 mov         r3, r3, lsr #20
  000f4	e1a02826	 mov         r2, r6, lsr #16
  000f8	e1a01006	 mov         r1, r6
  000fc	eb000000	 bl          NKDbgPrintfW

; 74   :         goto cleanUp;

  00100	ea000018	 b           |$cleanUp$43040|
  00104		 |$LN3@OEMIoContr|

; 75   :     }        
; 76   : 
; 77   :     // Take critical section if required (after postinit & no flag)
; 78   :     if (
; 79   :         g_ioctlState.postInit && 
; 80   :         (g_oalIoCtlTable[i].flags & OAL_IOCTL_FLAG_NOCS) == 0
; 81   :     ) {

  00104	e3520000	 cmp         r2, #0
  00108	0a000003	 beq         |$LN2@OEMIoContr|
  0010c	e5973004	 ldr         r3, [r7, #4]
  00110	e3130001	 tst         r3, #1

; 82   :         // Take critical section            
; 83   :         EnterCriticalSection(&g_ioctlState.cs);

  00114	02850004	 addeq       r0, r5, #4
  00118	0b000000	 bleq        EnterCriticalSection
  0011c		 |$LN2@OEMIoContr|

; 84   :     }
; 85   : 
; 86   :     // Execute the handler
; 87   :     rc = g_oalIoCtlTable[i].pfnHandler(
; 88   :         code, pInBuffer, inSize, pOutBuffer, outSize, pOutSize
; 89   :     );

  0011c	e1a00006	 mov         r0, r6
  00120	e59d6034	 ldr         r6, [sp, #0x34]
  00124	e5974008	 ldr         r4, [r7, #8]
  00128	e1a03009	 mov         r3, r9
  0012c	e58d6004	 str         r6, [sp, #4]
  00130	e59d6030	 ldr         r6, [sp, #0x30]
  00134	e1a0200a	 mov         r2, r10
  00138	e1a0100b	 mov         r1, r11
  0013c	e58d6000	 str         r6, [sp]
  00140	e1a0e00f	 mov         lr, pc
  00144	e12fff14	 bx          r4

; 90   : 
; 91   :     // Release critical section if it was taken above
; 92   :     if (
; 93   :         g_ioctlState.postInit && 
; 94   :         (g_oalIoCtlTable[i].flags & OAL_IOCTL_FLAG_NOCS) == 0
; 95   :     ) {

  00148	e5953000	 ldr         r3, [r5]
  0014c	e1a04000	 mov         r4, r0
  00150	e3530000	 cmp         r3, #0
  00154	0a000003	 beq         |$cleanUp$43040|
  00158	e5973004	 ldr         r3, [r7, #4]
  0015c	e3130001	 tst         r3, #1

; 96   :         // Release critical section            
; 97   :         LeaveCriticalSection(&g_ioctlState.cs);

  00160	02850004	 addeq       r0, r5, #4
  00164	0b000000	 bleq        LeaveCriticalSection
  00168		 |$cleanUp$43040|
  00168	e5983440	 ldr         r3, [r8, #0x440]

; 98   :     }
; 99   : 
; 100  : cleanUp:
; 101  :     OALMSG(OAL_IOCTL&&OAL_FUNC, (L"-OEMIoControl(rc = %d)\r\n", rc ));

  0016c	e3130a01	 tst         r3, #1, 20
  00170	13130004	 tstne       r3, #4
  00174	159f0014	 ldrne       r0, [pc, #0x14]
  00178	11a01004	 movne       r1, r4
  0017c	1b000000	 blne        NKDbgPrintfW

; 102  :     return rc;
; 103  : }

  00180	e1a00004	 mov         r0, r4
  00184	e28dd00c	 add         sp, sp, #0xC
  00188	e8bd4ff0	 ldmia       sp!, {r4 - r11, lr}
  0018c	e12fff1e	 bx          lr
  00190		 |$LN25@OEMIoContr|
  00190		 |$LN26@OEMIoContr|
  00190	00000000	 DCD         |??_C@_1DC@EGGJEANK@?$AA?9?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?$CI?$AAr?$AAc?$AA?5?$AA?$DN?$AA?5?$AA?$CF?$AAd?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@|
  00194		 |$LN27@OEMIoContr|
  00194	00000000	 DCD         |??_C@_1HM@LHHDIECD@?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?3?$AA?5?$AAU?$AAn?$AAs?$AAu?$AAp?$AAp?$AAo?$AAr?$AAt?$AAe?$AAd?$AA?5?$AAC?$AAo?$AAd?$AAe?$AA?5?$AA0@|
  00198		 |$LN28@OEMIoContr|
  00198	00000000	 DCD         |g_oalIoCtlTable|
  0019c		 |$LN29@OEMIoContr|
  0019c	010100b4	 DCD         0x10100b4
  001a0		 |$LN30@OEMIoContr|
  001a0	00000000	 DCD         |g_ioctlState|
  001a4		 |$LN31@OEMIoContr|
  001a4	00000000	 DCD         |??_C@_1GA@KJDOLNLD@?$AA?$CL?$AAO?$AAE?$AAM?$AAI?$AAo?$AAC?$AAo?$AAn?$AAt?$AAr?$AAo?$AAl?$AA?$CI?$AA0?$AAx?$AA?$CF?$AAx?$AA?0?$AA?5?$AA0?$AAx?$AA?$CF?$AAx?$AA?0?$AA?5?$AA?$CF?$AAd?$AA?0?$AA?5?$AA0?$AAx@|
  001a8		 |$LN32@OEMIoContr|
  001a8	00000000	 DCD         |dpCurSettings|
  001ac		 |$M43084|

			 ENDP  ; |OEMIoControl|

	END
