; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\COMMON\SRC\COMMON\TIMER\CNTCMP\cntcmp.c
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "

	EXPORT	|OALTimerInitCount|
	IMPORT	|OALTimerSetCompare|
	IMPORT	|OALTimerGetCount|

  00000			 AREA	 |.bss|, NOINIT
|g_timer| %	0x8
|g_timer| %	0x8
; File c:\wince600\platform\common\src\common\timer\cntcmp\cntcmp.c

  00000			 AREA	 |.pdata|, PDATA
|$T39066| DCD	|$LN5@OALTimerIn|
	DCD	0x40000c01
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OALTimerInitCount| PROC

; 45   : {

  00000		 |$LN5@OALTimerIn|
  00000	e92d4010	 stmdb       sp!, {r4, lr}
  00004		 |$M39063|
  00004	e1a04000	 mov         r4, r0

; 46   :     g_timer.base = OALTimerGetCount();

  00008	eb000000	 bl          OALTimerGetCount
  0000c	e59f1018	 ldr         r1, [pc, #0x18]
  00010	e1a02000	 mov         r2, r0

; 47   :     g_timer.compare = g_timer.base + period;

  00014	e0823004	 add         r3, r2, r4

; 48   :     OALTimerSetCompare(g_timer.compare); 

  00018	e1a00003	 mov         r0, r3
  0001c	e881000c	 stmia       r1, {r2, r3}
  00020	eb000000	 bl          OALTimerSetCompare

; 49   : }

  00024	e8bd4010	 ldmia       sp!, {r4, lr}
  00028	e12fff1e	 bx          lr
  0002c		 |$LN6@OALTimerIn|
  0002c		 |$LN7@OALTimerIn|
  0002c	00000000	 DCD         |g_timer|
  00030		 |$M39064|

			 ENDP  ; |OALTimerInitCount|

	EXPORT	|OALTimerRecharge|
	IMPORT	|OALTimerGetCompare|

  00000			 AREA	 |.pdata|, PDATA
|$T39079| DCD	|$LN8@OALTimerRe|
	DCD	0x40001301
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OALTimerRecharge| PROC

; 62   : {

  00000		 |$LN8@OALTimerRe|
  00000	e92d4070	 stmdb       sp!, {r4 - r6, lr}
  00004		 |$M39076|
  00004	e1a04001	 mov         r4, r1
  00008	e1a06000	 mov         r6, r0

; 63   :     UINT32 count;
; 64   : 
; 65   :     count = OALTimerGetCount();

  0000c	eb000000	 bl          OALTimerGetCount
  00010	e1a05000	 mov         r5, r0

; 66   :     // Check if recharge was called in required margin
; 67   :     if ((INT32)(count - OALTimerGetCompare() - margin) < 0) {

  00014	eb000000	 bl          OALTimerGetCompare

; 68   :         // Yes, base new period on previous (no shift)
; 69   :         g_timer.base = g_timer.compare;

  00018	e59f2028	 ldr         r2, [pc, #0x28]
  0001c	e0453000	 sub         r3, r5, r0
  00020	e0533004	 subs        r3, r3, r4
  00024	45923004	 ldrmi       r3, [r2, #4]

; 70   :         g_timer.compare += period;

  00028	40830006	 addmi       r0, r3, r6

; 71   :     } else {
; 72   :         // No, base new period on actual counter value (shift)
; 73   :         g_timer.base = count;
; 74   :         g_timer.compare = g_timer.base + period;

  0002c	50850006	 addpl       r0, r5, r6
  00030	45823000	 strmi       r3, [r2]
  00034	55825000	 strpl       r5, [r2]
  00038	e5820004	 str         r0, [r2, #4]

; 75   :     }
; 76   :     OALTimerSetCompare(g_timer.compare); 

  0003c	eb000000	 bl          OALTimerSetCompare

; 77   : }

  00040	e8bd4070	 ldmia       sp!, {r4 - r6, lr}
  00044	e12fff1e	 bx          lr
  00048		 |$LN9@OALTimerRe|
  00048		 |$LN10@OALTimerRe|
  00048	00000000	 DCD         |g_timer|
  0004c		 |$M39077|

			 ENDP  ; |OALTimerRecharge|

	EXPORT	|OALTimerCountsSinceSysTick|

  00000			 AREA	 |.pdata|, PDATA
|$T39090| DCD	|$LN5@OALTimerCo|
	DCD	0x40000801
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OALTimerCountsSinceSysTick| PROC

; 84   : {

  00000		 |$LN5@OALTimerCo|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004		 |$M39087|

; 85   :     return OALTimerGetCount() - g_timer.base;

  00004	eb000000	 bl          OALTimerGetCount
  00008	e59f300c	 ldr         r3, [pc, #0xC]
  0000c	e5933000	 ldr         r3, [r3]
  00010	e0400003	 sub         r0, r0, r3

; 86   : }

  00014	e49de004	 ldr         lr, [sp], #4
  00018	e12fff1e	 bx          lr
  0001c		 |$LN6@OALTimerCo|
  0001c		 |$LN7@OALTimerCo|
  0001c	00000000	 DCD         |g_timer|
  00020		 |$M39088|

			 ENDP  ; |OALTimerCountsSinceSysTick|

	EXPORT	|OALTimerUpdate|
	IMPORT	|__rt_udiv|

  00000			 AREA	 |.pdata|, PDATA
|$T39106| DCD	|$LN7@OALTimerUp|
	DCD	0x40001e01
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OALTimerUpdate| PROC

; 98   : {

  00000		 |$LN7@OALTimerUp|
  00000	e92d40f0	 stmdb       sp!, {r4 - r7, lr}
  00004		 |$M39103|
  00004	e1a04001	 mov         r4, r1
  00008	e1a07000	 mov         r7, r0

; 99   :     UINT32 rc, edge;
; 100  : 
; 101  :     // Get actual count value
; 102  :     edge = OALTimerGetCount() + margin;

  0000c	eb000000	 bl          OALTimerGetCount

; 103  :     // Are we at least edge before actual period end?
; 104  :     if ((INT32)(g_timer.compare - edge) > 0) {

  00010	e59f605c	 ldr         r6, [pc, #0x5C]
  00014	e0801004	 add         r1, r0, r4

; 105  :         // How many new period already passed from system tick
; 106  :         rc = (edge - g_timer.base)/period;

  00018	e1a00007	 mov         r0, r7
  0001c	e5962004	 ldr         r2, [r6, #4]
  00020	e0423001	 sub         r3, r2, r1
  00024	e3530000	 cmp         r3, #0
  00028	da00000a	 ble         |$LN2@OALTimerUp|
  0002c	e5964000	 ldr         r4, [r6]
  00030	e0411004	 sub         r1, r1, r4
  00034	eb000000	 bl          __rt_udiv
  00038	e1a05000	 mov         r5, r0

; 107  :         // Shift base and new compare
; 108  :         g_timer.base += rc * period;         

  0003c	e0234795	 mla         r3, r5, r7, r4

; 109  :         g_timer.compare = g_timer.base + period;

  00040	e0832007	 add         r2, r3, r7

; 110  :         // Program hardware
; 111  :         OALTimerSetCompare(g_timer.compare);

  00044	e1a00002	 mov         r0, r2
  00048	e5863000	 str         r3, [r6]
  0004c	e5862004	 str         r2, [r6, #4]
  00050	eb000000	 bl          OALTimerSetCompare

; 112  :     } else {

  00054	ea000003	 b           |$LN1@OALTimerUp|
  00058		 |$LN2@OALTimerUp|

; 113  :         // No, we are too close - stay with original period
; 114  :         rc = (g_timer.compare - g_timer.base)/period - 1;

  00058	e5963000	 ldr         r3, [r6]
  0005c	e0421003	 sub         r1, r2, r3
  00060	eb000000	 bl          __rt_udiv
  00064	e2405001	 sub         r5, r0, #1
  00068		 |$LN1@OALTimerUp|

; 115  :     }    
; 116  :     return rc;
; 117  : }

  00068	e1a00005	 mov         r0, r5
  0006c	e8bd40f0	 ldmia       sp!, {r4 - r7, lr}
  00070	e12fff1e	 bx          lr
  00074		 |$LN8@OALTimerUp|
  00074		 |$LN9@OALTimerUp|
  00074	00000000	 DCD         |g_timer|
  00078		 |$M39104|

			 ENDP  ; |OALTimerUpdate|

	END
