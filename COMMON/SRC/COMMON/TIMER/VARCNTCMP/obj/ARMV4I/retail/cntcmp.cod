; Listing generated by Microsoft (R) Optimizing Compiler Version 14.01.60511.01 

	TTL	C:\WINCE600\PLATFORM\COMMON\SRC\COMMON\TIMER\VARCNTCMP\cntcmp.c
	CODE32

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "

	EXPORT	|OALTimerInitCount|
	IMPORT	|OALTimerSetCompare|
	IMPORT	|OALTimerGetCount|

  00000			 AREA	 |.bss|, NOINIT
|g_timer| %	0x8
|g_timer| %	0x8
; File c:\wince600\platform\common\src\common\timer\varcntcmp\cntcmp.c

  00000			 AREA	 |.pdata|, PDATA
|$T39065| DCD	|$LN5@OALTimerIn|
	DCD	0x40000c01
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OALTimerInitCount| PROC

; 45   : {

  00000		 |$LN5@OALTimerIn|
  00000	e92d4010	 stmdb       sp!, {r4, lr}
  00004		 |$M39062|
  00004	e1a04000	 mov         r4, r0

; 46   :     g_timer.base = OALTimerGetCount();

  00008	eb000000	 bl          OALTimerGetCount
  0000c	e59f1018	 ldr         r1, [pc, #0x18]
  00010	e1a02000	 mov         r2, r0

; 47   :     g_timer.compare = g_timer.base + period;

  00014	e0823004	 add         r3, r2, r4

; 48   :     OALTimerSetCompare(g_timer.compare); 

  00018	e1a00003	 mov         r0, r3
  0001c	e881000c	 stmia       r1, {r2, r3}
  00020	eb000000	 bl          OALTimerSetCompare

; 49   : }

  00024	e8bd4010	 ldmia       sp!, {r4, lr}
  00028	e12fff1e	 bx          lr
  0002c		 |$LN6@OALTimerIn|
  0002c		 |$LN7@OALTimerIn|
  0002c	00000000	 DCD         |g_timer|
  00030		 |$M39063|

			 ENDP  ; |OALTimerInitCount|

	EXPORT	|OALTimerRecharge|
	IMPORT	|OALTimerGetCompare|

  00000			 AREA	 |.pdata|, PDATA
|$T39078| DCD	|$LN8@OALTimerRe|
	DCD	0x40001301
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OALTimerRecharge| PROC

; 62   : {

  00000		 |$LN8@OALTimerRe|
  00000	e92d4070	 stmdb       sp!, {r4 - r6, lr}
  00004		 |$M39075|
  00004	e1a04001	 mov         r4, r1
  00008	e1a06000	 mov         r6, r0

; 63   :     UINT32 count;
; 64   : 
; 65   :     count = OALTimerGetCount();

  0000c	eb000000	 bl          OALTimerGetCount
  00010	e1a05000	 mov         r5, r0

; 66   :     // Check if recharge was called in required margin
; 67   :     if ((INT32)(count - OALTimerGetCompare() - margin) < 0) {

  00014	eb000000	 bl          OALTimerGetCompare

; 68   :         // Yes, base new period on previous (no shift)
; 69   :         g_timer.base = g_timer.compare;

  00018	e59f2028	 ldr         r2, [pc, #0x28]
  0001c	e0453000	 sub         r3, r5, r0
  00020	e0533004	 subs        r3, r3, r4
  00024	45923004	 ldrmi       r3, [r2, #4]

; 70   :         g_timer.compare += period;

  00028	40830006	 addmi       r0, r3, r6

; 71   :     } else {
; 72   :         // No, base new period on actual counter value (shift)
; 73   :         g_timer.base = count;
; 74   :         g_timer.compare = g_timer.base + period;

  0002c	50850006	 addpl       r0, r5, r6
  00030	45823000	 strmi       r3, [r2]
  00034	55825000	 strpl       r5, [r2]
  00038	e5820004	 str         r0, [r2, #4]

; 75   :     }
; 76   :     OALTimerSetCompare(g_timer.compare); 

  0003c	eb000000	 bl          OALTimerSetCompare

; 77   : }

  00040	e8bd4070	 ldmia       sp!, {r4 - r6, lr}
  00044	e12fff1e	 bx          lr
  00048		 |$LN9@OALTimerRe|
  00048		 |$LN10@OALTimerRe|
  00048	00000000	 DCD         |g_timer|
  0004c		 |$M39076|

			 ENDP  ; |OALTimerRecharge|

	EXPORT	|OALTimerCountsSinceSysTick|

  00000			 AREA	 |.pdata|, PDATA
|$T39089| DCD	|$LN5@OALTimerCo|
	DCD	0x40000801
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OALTimerCountsSinceSysTick| PROC

; 84   : {

  00000		 |$LN5@OALTimerCo|
  00000	e52de004	 str         lr, [sp, #-4]!
  00004		 |$M39086|

; 85   :     return OALTimerGetCount() - g_timer.base;

  00004	eb000000	 bl          OALTimerGetCount
  00008	e59f300c	 ldr         r3, [pc, #0xC]
  0000c	e5933000	 ldr         r3, [r3]
  00010	e0400003	 sub         r0, r0, r3

; 86   : }

  00014	e49de004	 ldr         lr, [sp], #4
  00018	e12fff1e	 bx          lr
  0001c		 |$LN6@OALTimerCo|
  0001c		 |$LN7@OALTimerCo|
  0001c	00000000	 DCD         |g_timer|
  00020		 |$M39087|

			 ENDP  ; |OALTimerCountsSinceSysTick|

	EXPORT	|OALTimerUpdate|

  00000			 AREA	 |.pdata|, PDATA
|$T39103| DCD	|$LN7@OALTimerUp|
	DCD	0x40001101
; Function compile flags: /Ogspy

  00000			 AREA	 |.text|, CODE, ARM

  00000		 |OALTimerUpdate| PROC

; 99   : {

  00000		 |$LN7@OALTimerUp|
  00000	e92d4030	 stmdb       sp!, {r4, r5, lr}
  00004		 |$M39100|
  00004	e1a05001	 mov         r5, r1

; 100  :     UINT32 edge;
; 101  : 
; 102  :     // New compare value is base plus period
; 103  :     g_timer.compare = g_timer.base + period;

  00008	e59f4030	 ldr         r4, [pc, #0x30]
  0000c	e5943000	 ldr         r3, [r4]
  00010	e0833000	 add         r3, r3, r0
  00014	e5843004	 str         r3, [r4, #4]

; 104  :     // Are we more than margin before new compare?
; 105  :     edge = OALTimerGetCount() + margin;

  00018	eb000000	 bl          OALTimerGetCount

; 106  :     if ((INT32)(g_timer.compare - edge) > 0) {

  0001c	e5942004	 ldr         r2, [r4, #4]
  00020	e0800005	 add         r0, r0, r5
  00024	e0423000	 sub         r3, r2, r0
  00028	e3530000	 cmp         r3, #0

; 107  :        // Yes, then use calculated value
; 108  :        OALTimerSetCompare(g_timer.compare);

  0002c	c1a00002	 movgt       r0, r2

; 109  :     } else {
; 110  :        // No, shift real compare value
; 111  :        OALTimerSetCompare(edge);

  00030	eb000000	 bl          OALTimerSetCompare

; 112  :     }            
; 113  :     return 0;

  00034	e3a00000	 mov         r0, #0

; 114  : }

  00038	e8bd4030	 ldmia       sp!, {r4, r5, lr}
  0003c	e12fff1e	 bx          lr
  00040		 |$LN8@OALTimerUp|
  00040		 |$LN9@OALTimerUp|
  00040	00000000	 DCD         |g_timer|
  00044		 |$M39101|

			 ENDP  ; |OALTimerUpdate|

	END
